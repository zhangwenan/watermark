{"version":3,"sources":["watermark.js"],"names":["global","factory","exports","module","define","amd","this","toString","target","Object","prototype","call","hasOwnProp","prop","obj","hasOwnProperty","_typeof","Symbol","iterator","constructor","_typeof$1","isNumber","isNaN","isString","isFunction","isArray","isLooseObject","isGlobal","isPlainObject","nodeType","err","key","undefined","treatAsArray","result","length","isArrayLike","eachItem","callback","idx","ele","charAt","apply","name","value","extendTarget","args","arguments","i","deep","clone","copy","copyIsArray","opts","src","WATERMARK_DEFAULTS","id","preventTamper","width","height","text","font","rotate","Math","PI","shadow","offsetX","offsetY","blur","style","position","top","left","z-index","pointer-events","getElementById","document","indexOf","substring","createNewElement","tagName","createElement","createWatermarkContainer","url","canvas","ctx","getContext","shadowOffsetX","shadowOffsetY","shadowBlur","fillStyle","translate","translateX","translateY","textAlign","fillText","toDataURL","generateDataUrl","old","div","parentEl","body","container","rules","rect","getBoundingClientRect","cssText","v","k","push","join","setAttribute","background","appendChild","window","mhc","watermark","init"],"mappings":"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","file":"watermark.min.js","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(factory());\n}(this, (function () { 'use strict';\n\nfunction toString(target) {\n  return Object.prototype.toString.call(target);\n}\n\nfunction hasOwnProp(prop, obj) {\n  return obj != null && Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nvar _typeof$1 = typeof Symbol === \"function\" && _typeof(Symbol.iterator) === \"symbol\" ? function (obj) {\n  return typeof obj === \"undefined\" ? \"undefined\" : _typeof(obj);\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj === \"undefined\" ? \"undefined\" : _typeof(obj);\n};\n\n/**\n * 判断是否为布尔类型\n * \n * @param {*} target 目标\n */\nfunction isBoolean(target) {\n  return toString(target) === \"[object Boolean]\";\n}\n\n/**\n * 判断是否为数字类型\n * \n * 如果是 `NaN` 的话则返回 `false`\n * \n * @param {*} target 目标\n */\nfunction isNumber(target) {\n  return toString(target) === \"[object Number]\" && !isNaN(target);\n}\n\n/**\n * 判断是否为字符串类型\n * \n * @param {*} target 目标\n */\nfunction isString(target) {\n  return toString(target) === \"[object String]\";\n}\n\n/**\n * 判断是否为函数类型\n * \n * @param {*} target 目标\n */\nfunction isFunction(target) {\n  return toString(target) === \"[object Function]\";\n}\n\n/**\n * 判断是否为数组类型\n * \n * @param {*} target 目标\n */\nfunction isArray(target) {\n  return toString(target) === \"[object Array]\";\n}\n\n/**\n * 判断是否为对象类型\n * \n * @param {*} target 目标\n */\nfunction isObject(target) {\n  return toString(target) === \"[object Object]\";\n}\n\n/**\n * 宽松地判断是否为对象类型\n * \n * @param {*} target 目标\n */\nfunction isLooseObject(target) {\n  return (typeof target === \"undefined\" ? \"undefined\" : _typeof$1(target)) === \"object\";\n}\n\n/**\n * 判断是否为宿主环境全局对象\n * \n * 在浏览器环境中就是 `window` 对象\n * \n * @param {*} target 目标\n */\nfunction isGlobal(target) {\n  return target && isLooseObject(target) && \"setInterval\" in target;\n}\n\n/**\n * 判断是否为类数组对象\n * \n * @param {*} target 目标\n */\nfunction isArrayLike(target) {\n  var result = false;\n\n  if (isLooseObject(target) && !isGlobal(target)) {\n    var length = target.length;\n\n    if (target.nodeType === 1 && length || !isArray(target) && !isFunction(target) && (length === 0 || isNumber(length) && length > 0 && length - 1 in target)) {\n      result = true;\n    }\n  }\n\n  return result;\n}\n\n/**\n * 判断是否为纯对象\n * \n * @param {*} target 目标\n */\nfunction isPlainObject(target) {\n  if (!target || !isLooseObject(target) || target.nodeType || isGlobal(target)) {\n    return false;\n  }\n\n  try {\n    if (target.constructor && !hasOwnProp(\"constructor\", target) && !hasOwnProp(\"isPrototypeOf\", target.constructor.prototype)) {\n      return false;\n    }\n  } catch (err) {\n    return false;\n  }\n\n  var key = void 0;\n\n  for (key in target) {\n  }\n\n  return key === undefined || hasOwnProp(key, target);\n}\n\n/**\n * 电子邮箱\n * \n * 参考自：https://html.spec.whatwg.org/multipage/forms.html#e-mail-state-(type=email)\n */\n\n/**\n * 获取用户代理字符串\n */\n\n/**\n * 判断是否当作数组进行处理\n * \n * @param {*} target 目标\n */\nfunction treatAsArray(target) {\n  return isString(target) || isArray(target) || isArrayLike(target);\n}\n\n/**\n * 遍历指定对象\n * \n * 与 `jQuery.each()` 效果类似\n * \n * 详见：http://api.jquery.com/jQuery.each/\n * \n * @param {*} target 目标\n * @param {*} callback 应用到每个元素的处理函数\n */\nfunction eachItem(target, callback) {\n  if (treatAsArray(target)) {\n    var idx = 0;\n    var ele = void 0;\n\n    while (idx < target.length) {\n      ele = isString(target) ? target.charAt(idx) : target[idx];\n\n      if (callback.apply(ele, [ele, idx++, target]) === false) {\n        break;\n      }\n    }\n  } else if (isObject(target) || isFunction(target)) {\n    var name = void 0,\n        value = void 0;\n\n    for (name in target) {\n      value = target[name];\n\n      if (callback.apply(value, [value, name, target]) === false) {\n        break;\n      }\n    }\n  }\n}\n\n/**\n * 扩展指定对象\n * \n * 与 `jQuery.extend()` 效果一样\n * \n * 详见：http://api.jquery.com/jQuery.extend/\n */\nfunction extendTarget() {\n  var args = arguments;\n  var length = args.length;\n\n  var target = args[0] || {};\n  var i = 1;\n  var deep = false;\n  var clone = void 0,\n      copy = void 0,\n      copyIsArray = void 0,\n      name = void 0,\n      opts = void 0,\n      src = void 0;\n\n  if (isBoolean(target)) {\n    deep = target;\n    target = args[1] || {};\n    i = 2;\n  }\n\n  if (!isLooseObject(target) && !isFunction(target)) {\n    target = {};\n  }\n\n  if (length === 1) {\n    target = this;\n    i--;\n  }\n\n  while (i < length) {\n    opts = args[i];\n\n    if (opts != null) {\n      for (name in opts) {\n        copy = opts[name];\n        src = target[name];\n\n        if (copy === target) {\n          continue;\n        }\n\n        if (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n          if (copyIsArray) {\n            copyIsArray = false;\n            clone = src && isArray(src) ? src : [];\n          } else {\n            clone = src && isPlainObject(src) ? src : {};\n          }\n\n          target[name] = extendTarget(deep, clone, copy);\n        } else if (copy !== undefined) {\n          target[name] = copy;\n        }\n      }\n    }\n\n    i++;\n  }\n\n  return target;\n}\n\nvar WATERMARK_DEFAULTS = {\n  id: \"watermark\",\n  preventTamper: false,\n  width: 140,\n  height: 100,\n  text: \"watermark\",\n  font: \"20px Sans-serif\",\n  rotate: Math.PI / 180 * 30,\n  shadow: {\n    offsetX: 2,\n    offsetY: 2,\n    blur: 2\n  },\n  style: {\n    width: \"100%\",\n    height: \"100%\",\n    position: \"fixed\",\n    top: 0,\n    left: 0,\n    \"z-index\": 1000,\n    \"pointer-events\": \"none\"\n  }\n};\n\nfunction getElementById(id) {\n  document.getElementById(id.indexOf(\"#\") === 0 ? id.substring(1) : id);\n}\n\nfunction createNewElement(tagName) {\n  return document.createElement(tagName);\n}\n\nfunction generateDataUrl(opts) {\n  var canvas = createNewElement(\"canvas\");\n\n  canvas.width = opts.width;\n  canvas.height = opts.height;\n\n  var ctx = canvas.getContext(\"2d\");\n\n  // X 轴阴影距离，负值表示往上，正值表示往下\n  ctx.shadowOffsetX = opts.shadow.offsetX;\n  // Y 轴阴影距离，负值表示往左，正值表示往右\n  ctx.shadowOffsetY = opts.shadow.offsetX;\n  // 阴影的模糊程度\n  ctx.shadowBlur = opts.shadow.offsetX;\n  // 阴影颜色\n  // ctx.shadowColor = \"rgba(0, 0, 0, 0.5)\";\n  ctx.font = opts.font;\n  ctx.fillStyle = \"rgba(204, 204, 204, 0.45)\";\n  ctx.rotate(opts.rotate);\n  ctx.translate(opts.translateX, opts.translateY);\n  ctx.textAlign = \"left\";\n  // 实体文字\n  ctx.fillText(opts.text, 35, 32);\n\n  return canvas.toDataURL(\"image/png\");\n}\n\nfunction resolveStyleText(opts) {\n  var rules = [];\n\n  eachItem(opts, function (v, k) {\n    return rules.push(k + \": \" + v + \";\");\n  });\n\n  return rules.join(\" \");\n}\n\nfunction createWatermarkContainer(opts) {\n  var url = generateDataUrl(opts);\n  var old = getElementById(opts.id);\n  var div = old || createNewElement(\"div\");\n\n  div.id = opts.id;\n\n  var parentEl = opts.preventTamper === true ? document.body : opts.container || document.body;\n\n  if (isString(parentEl)) {\n    parentEl = getElementById(parentEl);\n  }\n\n  var rect = parentEl.getBoundingClientRect();\n\n  opts.style.left = (isNumber(opts.left) ? opts.left : rect.left) + \"px\";\n  opts.style.top = (isNumber(opts.top) ? opts.top : rect.top) + \"px\";\n\n  div.style.cssText = resolveStyleText(opts.style);\n  div.setAttribute(\"class\", \"\");\n\n  div.style.background = \"url(\" + url + \") repeat top left\";\n\n  !old && parentEl.appendChild(div);\n\n  return div;\n}\n\nfunction init(opts) {\n  opts = extendTarget(true, {}, WATERMARK_DEFAULTS, opts);\n\n  if (isFunction(opts.container)) {\n    opts.container = opts.container.call(null);\n  }\n\n  return createWatermarkContainer(opts);\n}\n\nwindow.mhc = window.mhc || {};\nwindow.mhc.watermark = { init: init };\n\n})));\n"]}